package com.bank.dao.impl;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import com.bank.dao.TransationServiceDAO;
import com.bank.dao.util.PostresqlConnection;
import com.bank.exception.BussinessException;
import com.bank.modal.Account;

public class TransactionServiceDAOImpl implements TransationServiceDAO {

	@Override
	public int depositeToAccount(Account account, float amount) throws BussinessException {
		//INSERT INTO bank."transaction" (t_id, acc_num, "date", msg, amount, t_type, balance, emp_id, status) VALUES(2, 100001, '2021-01-02', 'Amount debit', 1000.1234, 'debit', 0.0, NULL, 0);
		int c= 0;
		String msg = "Amount Debit to Account";
		String t_type = "debit";
		float balance = account.getBalance() + amount;
		try ( Connection connection = PostresqlConnection.getConnection() ) {
			
			String query = "insert into bank.transaction (acc_num, date, msg, amount, t_type, balance) values (?,?,?,?,?,?)";
			PreparedStatement preparedStatement = connection.prepareStatement(query);
			preparedStatement.setLong(1, account.getAcc_num());
			preparedStatement.setDate(2, new Date(new java.util.Date().getTime()));
			preparedStatement.setString(3, msg);
			preparedStatement.setFloat(4, amount);
			preparedStatement.setString(5, t_type);
			preparedStatement.setFloat(6, balance);
			c = preparedStatement.executeUpdate();
			
			logFile.trace(c);
			
		} catch (ClassNotFoundException e) {
			log.error(e);
		} catch (SQLException e) {
			log.error(e);
		}
		
		if(c != 0)
			return c;
		else
			throw new BussinessException("Transaction Incomplited / Transaction is not Done.");

	}

	@Override
	public int widrawToAccount(Account account, float amount) throws BussinessException {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public Account BalanceOfAccount(Account account) throws BussinessException {
		// TODO Auto-generated method stub
		return null;
	}

}
